const NAME=`DOM99`,ELEMENT_NODE=1,CONTEXT=`${"DOM99"}_C`,LIST_ITEM_PROPERTY=`${"DOM99"}_L`,ELEMENT_PROPERTY=`${"DOM99"}_E`,ELEMENT_LIST_ITEM=`${"DOM99"}_I`,CUSTOM_ELEMENT=`${"DOM99"}_X`,LIST_CHILDREN=`${"DOM99"}_R`,INSIDE_SYMBOL=`>`,variableSubscribers={},listSubscribers={},variables={},elements={},templateFromName={},functions={};let directivePairs,feed,elementsDeepForEach,activate,activateCloneTemplate,pathIn=[];const hasOwnProperty=Object.prototype.hasOwnProperty,freezeLiveCollection=function(a){const b=a.length,c=[];let d;for(d=0;d<b;d+=1)c.push(a[d]);return c},isObjectOrArray=function(a){return`object`==typeof a&&null!==a},copyArrayFlat=function(a){return a.slice()},pushOrCreateArrayAt=function(a,b,c){hasOwnProperty.call(a,b)?a[b].push(c):a[b]=[c]},MISS=`MISS`,valueElseMissDecorator=function(a){return function(b){return hasOwnProperty.call(a,b)?a[b]:a[MISS]}},propertyFromTag=valueElseMissDecorator({[`INPUT`]:`value`,[`TEXTAREA`]:`value`,[`PROGRESS`]:`value`,[`SELECT`]:`value`,[`IMG`]:`src`,[`SOURCE`]:`src`,[`AUDIO`]:`src`,[`VIDEO`]:`src`,[`TRACK`]:`src`,[`SCRIPT`]:`src`,[`OPTION`]:`value`,[`LINK`]:`href`,[`DETAILS`]:`open`,MISS:`textContent`}),propertyFromInputType=valueElseMissDecorator({[`checkbox`]:`checked`,[`radio`]:`checked`,MISS:`value`}),inputEventFromType=valueElseMissDecorator({[`checkbox`]:`change`,[`radio`]:`change`,[`range`]:`change`,[`file`]:`change`,MISS:`input`}),eventFromTag=valueElseMissDecorator({[`SELECT`]:`change`,[`TEXTAREA`]:`input`,[`BUTTON`]:`click`,MISS:`click`}),options={doneSymbol:`*`,tokenSeparator:`-`,listSeparator:` `,directives:{function:`data-function`,variable:`data-variable`,element:`data-element`,list:`data-list`,inside:`data-inside`,template:`data-template`},propertyFromElement:function(a){let b;return b=void 0===a.tagName?a:a.tagName,`INPUT`===b?propertyFromInputType(a.type):propertyFromTag(b)},eventNameFromElement:function(a){const b=a.tagName;return`INPUT`===b?inputEventFromType(a.type):eventFromTag(b)},tagNamesForUserInput:[`INPUT`,`TEXTAREA`,`SELECT`,`DETAILS`]},createElement2=function(a){const b=document.createElement(a.tagName);return Object.entries(a).forEach(function([a,c]){`tagName`!==a&&b.setAttribute(a,c)}),b};elementsDeepForEach=function(a,b){b(a);for(let c=a.firstChild;c;)c.nodeType===ELEMENT_NODE?(elementsDeepForEach(c,b),c=c.nextElementSibling):c=c.nextSibling};const customElementNameFromElement=function(a){return a.getAttribute(`is`)||a.tagName.toLowerCase()},addEventListener=function(a,b,c,d=!1){a.addEventListener(b,c,d)},cloneTemplate=function(a){return a||console.error(`Template missing <template ${options.directives.template}="d-name">
				Template Content
			</template>`),a.content||console.error(`template.content is undefined, this can happen if a template is inside another template. Use only top level templates`),document.importNode(a.content,!0)},contextFromEvent=function(a,b){if(a||b){let c;if(c=a&&a.target?a.target:b,hasOwnProperty.call(c,CONTEXT))return c[CONTEXT];if(c.parentNode)return contextFromEvent(void 0,c.parentNode)}return console.warn(a,`has no context. contextFromEvent for top level elements is not needed.`),``},contextFromArray=function(a){return a.join(INSIDE_SYMBOL)},enterObject=function(a){pathIn.push(a)},leaveObject=function(){pathIn.pop()},getParentContext=function(a){const b=a.split(INSIDE_SYMBOL);return b.pop(),b.join(INSIDE_SYMBOL)},contextFromArrayWith=function(a,b){return 0===a.length?b:`${contextFromArray(a)}${INSIDE_SYMBOL}${b}`},normalizeStartPath=function(a){return a?`${a}${INSIDE_SYMBOL}`:a},deleteAllStartsWith=function(a,b){Object.keys(a).forEach(function(c){c.startsWith(b)&&delete a[c]})},forgetContext=function(a){deleteAllStartsWith(variableSubscribers,a),deleteAllStartsWith(listSubscribers,a),deleteAllStartsWith(variables,a),deleteAllStartsWith(elements,a)},notifyOneVariableSubscriber=function(a,b){a[a[ELEMENT_PROPERTY]]=b},notifyVariableSubscribers=function(a,b){void 0===b||a.forEach(function(a){notifyOneVariableSubscriber(a,b)})},removeNode=function(a){a.remove()},notifyOneListSubscriber=function(a,b,c){const d=document.createDocumentFragment();if(hasOwnProperty.call(a,CUSTOM_ELEMENT)&&hasOwnProperty.call(templateFromName,a[CUSTOM_ELEMENT])){const e=templateFromName[a[CUSTOM_ELEMENT]],f=copyArrayFlat(pathIn);pathIn=b.split(INSIDE_SYMBOL);const g=normalizeStartPath(b),h=c.length;let j,k;if(!hasOwnProperty.call(a,LIST_CHILDREN))a[LIST_CHILDREN]=[],j=0;else if(j=a[LIST_CHILDREN].length,j>h){let b;for(b=h;b<j;b+=1)k=`${g}${b}`,a[LIST_CHILDREN][b].forEach(removeNode),forgetContext(k);a[LIST_CHILDREN].length=h}c.forEach(function(b,c){if(k=`${g}${c}`,feed(k,b),c>=j){const b=activateCloneTemplate(e,c+"");a[LIST_CHILDREN].push(freezeLiveCollection(b.childNodes)),d.appendChild(b)}}),pathIn=f}else a.innerHTML=``,c.forEach(function(b){const c=document.createElement(a[ELEMENT_LIST_ITEM]);isObjectOrArray(b)?Object.assign(c,b):c[a[LIST_ITEM_PROPERTY]]=b,d.appendChild(c)});a.appendChild(d)},notifyListSubscribers=function(a,b,c){a.forEach(function(a){notifyOneListSubscriber(a,b,c)})};feed=function(a,b){if(void 0===b&&(b=a,a=``),isObjectOrArray(a)&&console.error(`Incorrect types passed to d.feed,
			d.feed(string, object) or d.feed(object)`),!isObjectOrArray(b))variables[a]=b,hasOwnProperty.call(variableSubscribers,a)&&notifyVariableSubscribers(variableSubscribers[a],b);else if(Array.isArray(b))variables[a]=b,hasOwnProperty.call(listSubscribers,a)&&notifyListSubscribers(listSubscribers[a],a,b);else{const c=normalizeStartPath(a);Object.entries(b).forEach(function([a,b]){feed(`${c}${a}`,b)})}};const applyFunctionOriginal=function(a,b,c){functions[c]||console.error(`Event listener ${c} not found.`),addEventListener(a,b,functions[c]),a[CONTEXT]=contextFromArray(pathIn)},pluggedFunctions=[];let applyFunction=applyFunctionOriginal;const applyFunctions=function(a,b){b.split(options.listSeparator).forEach(function(b){const c=b.split(options.tokenSeparator);let d,e;1===c.length?(d=c[0],e=options.eventNameFromElement(a)):[e,d]=c,applyFunction(a,e,d)})},applylist=function(a,b){const[c,d,e]=b.split(options.tokenSeparator);let f=`-`;c||console.error(a,`Use ${options.directives.list}="variableName-tagName" format!`),e?(f=`${d}-${e}`,a[CUSTOM_ELEMENT]=f):(a[LIST_ITEM_PROPERTY]=options.propertyFromElement(d.toUpperCase()),a[ELEMENT_LIST_ITEM]=d);const g=contextFromArrayWith(pathIn,c);pushOrCreateArrayAt(listSubscribers,g,a),hasOwnProperty.call(variables,g)&&notifyOneListSubscriber(a,g,variables[g])},applyVariable=function(a,b){b||console.error(a,`Use ${options.directives.variable}="variableName" format!`),a[ELEMENT_PROPERTY]=options.propertyFromElement(a);const c=contextFromArrayWith(pathIn,b);pushOrCreateArrayAt(variableSubscribers,c,a);const d=variables[c];if(void 0!==d&&notifyOneVariableSubscriber(a,d),options.tagNamesForUserInput.includes(a.tagName)){addEventListener(a,options.eventNameFromElement(a),function(b){const d=b.target[b.target[ELEMENT_PROPERTY]];variables[c]=d,variableSubscribers[c].forEach(function(b){b!==a&&notifyOneVariableSubscriber(b,d)})})}},applyDirectiveElement=function(a,b){const c=b;c||console.error(a,`Use ${options.directives.element}="elementName" format!`);const d=contextFromArrayWith(pathIn,c);elements[d]=a},applytemplate=function(a,b){b||console.error(a,`Use ${options.directives.template}="d-name" format!`),templateFromName[b]=a};activateCloneTemplate=function(a,b){enterObject(b);const c=cloneTemplate(a);return activate(c),leaveObject(),c};const applyInside=function(a,b){b||console.error(a,`Use ${options.directives.inside}="insidewhat" format!`);const c=templateFromName[customElementNameFromElement(a)];if(c){const d=activateCloneTemplate(c,b);a.appendChild(d)}else a.setAttribute(options.directives.inside,options.doneSymbol+b),enterObject(b),activate(a),leaveObject()},deleteTemplate=function(a){hasOwnProperty.call(templateFromName,a)||console.error(`<template ${options.directives.template}=${a}>
			</template> not found or already deleted and removed.`),templateFromName[a].remove(),delete templateFromName[a]},tryApplyDirectives=function(a){if(!a.hasAttribute)return;const b=Object.values(options.directives),c=Array.prototype.slice.call(a.attributes);if(c.forEach(function(a){if(a.nodeName.startsWith(`data`))if(b.includes(a.nodeName));else console.warn(`dom99 does not recognize ${a.nodeName}`)}),directivePairs.forEach(function([b,c]){if(a.hasAttribute(b)){const d=a.getAttribute(b);d[0]===options.doneSymbol||(c(a,d),a.setAttribute(b,options.doneSymbol+d))}}),!(a.hasAttribute(options.directives.inside)||a.hasAttribute(options.directives.list))){let b=customElementNameFromElement(a);hasOwnProperty.call(templateFromName,b)&&a.appendChild(cloneTemplate(templateFromName[b]))}};activate=function(a=document.body){return directivePairs||(directivePairs=[[options.directives.element,applyDirectiveElement],[options.directives.variable,applyVariable],[options.directives.function,applyFunctions],[options.directives.list,applylist],[options.directives.inside,applyInside],[options.directives.template,applytemplate]]),elementsDeepForEach(a,tryApplyDirectives),a};const start=function(a={},b={},c=document.body,d=void 0){return Object.assign(functions,a),feed(b),activate(c),d?d():void 0},plugin=function(a){hasOwnProperty.call(a,`directives`)&&hasOwnProperty.call(a.directives,`function`)&&(pluggedFunctions.push(a.directives.function),applyFunction=function(a,b,c){let d=!1;const e=function(){d=!0};pluggedFunctions.forEach(function(d){d(a,b,c,functions,e)});d||applyFunctionOriginal(a,b,c)})};export default Object.freeze({start,activate,elements,functions,variables,feed,createElement2,forgetContext,deleteTemplate,contextFromArray,contextFromEvent,getParentContext,options,plugin});