const createElement2=e=>{const t=document.createElement(e.tagName);return Object.entries(e).forEach(function([e,r]){"tagName"!==e&&t.setAttribute(e,r)}),t},isObjectOrArray=e=>"object"==typeof e&&null!==e,copyArrayShallow=e=>e.slice(),freezeLiveCollection=e=>{const t=e.length,r=[];let n;for(n=0;n<t;n+=1)r.push(e[n]);return r},firstAncestorValue=function(e,t){const r=t(e);if(r)return r;const n=e.parentNode;return n?firstAncestorValue(n,t):void 0},prefix="id-";let next=Number.MAX_SAFE_INTEGER;const idGenerator=()=>{const e=`id-${next}`;return next-=1,e},ELEMENT_NODE=1,hasOwnProperty=Object.prototype.hasOwnProperty,NAME="DOM99",CONTEXT="DOM99_C",LIST_ITEM_PROPERTY="DOM99_L",ELEMENT_LIST_ITEM="DOM99_I",CUSTOM_ELEMENT="DOM99_X",LIST_CHILDREN="DOM99_R",INSIDE_SYMBOL=">",variableSubscribers={},listSubscribers={},variables={},elements={},templateFromName={},functions={};let pathIn=[];const functionPlugins=[];let alreadyHooked=!1;const feedPlugins=[],clonePlugins=[];let directivePairs;const pushOrCreateArrayAt=(e,t,r)=>{hasOwnProperty.call(e,t)?e[t].push(r):e[t]=[r]},MISS="MISS",valueElseMissDecorator=e=>t=>hasOwnProperty.call(e,t)?e[t]:e.MISS,propertyFromTag=valueElseMissDecorator({INPUT:"value",TEXTAREA:"value",PROGRESS:"value",SELECT:"value",IMG:"src",SOURCE:"src",AUDIO:"src",VIDEO:"src",TRACK:"src",SCRIPT:"src",OPTION:"value",LINK:"href",DETAILS:"open",MISS:"textContent"}),propertyFromInputType=valueElseMissDecorator({checkbox:"checked",radio:"checked",MISS:"value"}),inputEventFromType=valueElseMissDecorator({checkbox:"change",radio:"change",range:"change",file:"change",MISS:"input"}),eventFromTag=valueElseMissDecorator({SELECT:"change",TEXTAREA:"input",BUTTON:"click",MISS:"click"}),options={doneSymbol:"*",tokenSeparator:"-",listSeparator:" ",directives:{"function":"data-function",variable:"data-variable",element:"data-element",list:"data-list",inside:"data-inside",template:"data-template"},propertyFromElement:e=>{let t;return"INPUT"===(t=e.tagName!==undefined?e.tagName:e)?propertyFromInputType(e.type):propertyFromTag(t)},eventNameFromElement:e=>{const t=e.tagName;return"INPUT"===t?inputEventFromType(e.type):eventFromTag(t)},tagNamesForUserInput:["INPUT","TEXTAREA","SELECT","DETAILS"]},elementsDeepForEach=(e,t)=>{t(e);let r=e.firstChild;for(;r;)1===r.nodeType?(elementsDeepForEach(r,t),r=r.nextElementSibling):r=r.nextSibling},customElementNameFromElement=e=>{const t=e.getAttribute("is");return t||e.tagName.toLowerCase()},addEventListener=(e,t,r,n=!1)=>{e.addEventListener(t,r,n)},cloneTemplate=e=>(e.content,document.importNode(e.content,!0)),contextFromElement=e=>e.DOM99_C,contextFromEvent=e=>firstAncestorValue(e.target,contextFromElement)||"",contextFromArray=e=>e.join(">"),enterObject=e=>{pathIn.push(e)},leaveObject=function(){pathIn.pop()},getParentContext=e=>{const t=e.split(">");return t.pop(),t.join(">")},contextFromArrayWith=(e,t)=>0===e.length?t:`${contextFromArray(e)}>${t}`,normalizeStartPath=e=>e?`${e}>`:e,deleteAllStartsWith=(e,t)=>{Object.keys(e).forEach(r=>{r.startsWith(t)&&delete e[r]})},forgetContext=e=>{deleteAllStartsWith(variableSubscribers,e),deleteAllStartsWith(listSubscribers,e),deleteAllStartsWith(variables,e),deleteAllStartsWith(elements,e)},notifyOneVariableSubscriber=(e,t)=>{e[options.propertyFromElement(e)]=t},notifyVariableSubscribers=(e,t)=>{t!==undefined&&e.forEach(e=>{notifyOneVariableSubscriber(e,t)})},removeNode=e=>{e.remove()},notifyOneListSubscriber=(e,t,r)=>{const n=document.createDocumentFragment();if(hasOwnProperty.call(e,"DOM99_X")&&hasOwnProperty.call(templateFromName,e.DOM99_X)){const a=templateFromName[e.DOM99_X],o=copyArrayShallow(pathIn);pathIn=t.split(">");const i=normalizeStartPath(t),s=r.length;let l,c;if(hasOwnProperty.call(e,"DOM99_R")){if((l=e.DOM99_R.length)>s){let t;for(t=s;t<l;t+=1)c=`${i}${t}`,e.DOM99_R[t].forEach(removeNode),forgetContext(c);e.DOM99_R.length=s}}else e.DOM99_R=[],l=0;r.forEach((t,r)=>{if(feed(c=`${i}${r}`,t),r>=l){const t=activateCloneTemplate(a,String(r));e.DOM99_R.push(freezeLiveCollection(t.childNodes)),n.appendChild(t)}}),pathIn=o}else e.innerHTML="",r.forEach(t=>{const r=document.createElement(e.DOM99_I);isObjectOrArray(t)?Object.assign(r,t):r[e.DOM99_L]=t,n.appendChild(r)});e.appendChild(n)},notifyListSubscribers=(e,t,r)=>{e.forEach(e=>{notifyOneListSubscriber(e,t,r)})},feed=(e,t)=>{if(t===undefined&&(t=e,e=""),isObjectOrArray(e),alreadyHooked||feedHook(e,t),isObjectOrArray(t))if(Array.isArray(t))variables[e]=t,hasOwnProperty.call(listSubscribers,e)&&notifyListSubscribers(listSubscribers[e],e,t);else{const r=normalizeStartPath(e);alreadyHooked=!0,Object.entries(t).forEach(([e,t])=>{feed(`${r}${e}`,t)}),alreadyHooked=!1}else variables[e]=t,hasOwnProperty.call(variableSubscribers,e)&&notifyVariableSubscribers(variableSubscribers[e],t)},applyFunctionOriginal=(e,t,r)=>{addEventListener(e,t,functions[r]),e.DOM99_C=contextFromArray(pathIn)};let applyFunction=applyFunctionOriginal;const applyFunctions=(e,t)=>{t.split(options.listSeparator).forEach(t=>{const r=t.split(options.tokenSeparator);let n,a;1===r.length?(n=r[0],a=options.eventNameFromElement(e)):[a,n]=r,applyFunction(e,a,n)})},applylist=(e,t)=>{const[r,n,a]=t.split(options.tokenSeparator);let o="-";a?(o=`${n}-${a}`,e.DOM99_X=o):(e.DOM99_L=options.propertyFromElement(n.toUpperCase()),e.DOM99_I=n);const i=contextFromArrayWith(pathIn,r);pushOrCreateArrayAt(listSubscribers,i,e),hasOwnProperty.call(variables,i)&&notifyOneListSubscriber(e,i,variables[i])},applyVariable=(e,t)=>{const r=contextFromArrayWith(pathIn,t);pushOrCreateArrayAt(variableSubscribers,r,e);const n=variables[r];if(n!==undefined&&notifyOneVariableSubscriber(e,n),!options.tagNamesForUserInput.includes(e.tagName))return;addEventListener(e,options.eventNameFromElement(e),t=>{const n=e[options.propertyFromElement(e)];variables[r]=n,feedHook(r,n),variableSubscribers[r].forEach(t=>{t!==e&&notifyOneVariableSubscriber(t,n)})})},applyDirectiveElement=(e,t)=>{const r=t,n=contextFromArrayWith(pathIn,r);elements[n]=e},applytemplate=(e,t)=>{templateFromName[t]=e},activateCloneTemplate=(e,t)=>{enterObject(t);const r=cloneTemplate(e);return activate(r),cloneHook(),leaveObject(),r},applyInside=(e,t)=>{const r=templateFromName[customElementNameFromElement(e)];if(r){const n=activateCloneTemplate(r,t);e.appendChild(n)}else e.setAttribute(options.directives.inside,options.doneSymbol+t),enterObject(t),activate(e),leaveObject()},deleteTemplate=e=>{hasOwnProperty.call(templateFromName,e),templateFromName[e].remove(),delete templateFromName[e]},tryApplyDirectives=e=>{if(!e.hasAttribute)return;const t=Object.values(options.directives);if(Array.prototype.slice.call(e.attributes).forEach(e=>{e.nodeName.startsWith("data")&&t.includes(e.nodeName)}),directivePairs.forEach(([t,r])=>{if(!e.hasAttribute(t))return;const n=e.getAttribute(t);n[0]!==options.doneSymbol&&(r(e,n),e.setAttribute(t,`${options.doneSymbol}${n}`))}),e.hasAttribute(options.directives.inside)||e.hasAttribute(options.directives.list))return;let r=customElementNameFromElement(e);hasOwnProperty.call(templateFromName,r)&&e.appendChild(cloneTemplate(templateFromName[r]))},activate=(e=document.body)=>(directivePairs||(directivePairs=[[options.directives.element,applyDirectiveElement],[options.directives.variable,applyVariable],[options.directives["function"],applyFunctions],[options.directives.list,applylist],[options.directives.inside,applyInside],[options.directives.template,applytemplate]]),elementsDeepForEach(e,tryApplyDirectives),e),start=(e={},t={},r=document.body,n=undefined)=>{if(Object.assign(functions,e),feed(t),activate(r),n)return n()},cloneHook=function(){const e=contextFromArray(pathIn);clonePlugins.forEach(t=>{t(e)})},feedHook=(e,t)=>{feedPlugins.forEach(r=>{r(e,t)})},plugin=e=>{isObjectOrArray(e),"function"===e.type?(functionPlugins.push(e.plugin),applyFunction=((e,t,r)=>{let n=!1;const a=function(){n=!0};functionPlugins.forEach(n=>{n(e,t,r,functions,a)}),n||applyFunctionOriginal(e,t,r)})):"variable"===e.type?feedPlugins.push(e.plugin):"cloned"===e.type&&clonePlugins.push(e.plugin)};export{start,activate,elements,functions,variables,feed,forgetContext,deleteTemplate,contextFromArray,contextFromEvent,getParentContext,plugin,options,createElement2,idGenerator};