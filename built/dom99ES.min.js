const createElement2=e=>{const t=document.createElement(e.tagName);return Object.entries(e).forEach(function([e,r]){"tagName"!==e&&t.setAttribute(e,r)}),t},isObjectOrArray=e=>"object"==typeof e&&null!==e,copyArrayShallow=e=>e.slice(),freezeLiveCollection=e=>{const t=e.length,r=[];let n;for(n=0;n<t;n+=1)r.push(e[n]);return r},firstAncestorValue=function(e,t){const r=t(e);if(r)return r;const n=e.parentNode;return n?firstAncestorValue(n,t):void 0},pushOrCreateArrayAt=(e,t,r)=>{Object.prototype.hasOwnProperty.call(e,t)?e[t].push(r):e[t]=[r]},prefix="id-";let next=Number.MAX_SAFE_INTEGER;const idGenerator=()=>{const e=`id-${next}`;return next-=1,e},ELEMENT_NODE=1,hasOwnProperty=Object.prototype.hasOwnProperty,NAME="DOM99",CONTEXT="DOM99_C",LIST_ITEM_PROPERTY="DOM99_L",ELEMENT_LIST_ITEM="DOM99_I",CUSTOM_ELEMENT="DOM99_X",LIST_CHILDREN="DOM99_R",INSIDE_SYMBOL=">",MISS="MISS",valueElseMissDecorator=e=>t=>hasOwnProperty.call(e,t)?e[t]:e.MISS,removeNode=e=>{e.remove()},propertyFromTag=valueElseMissDecorator({INPUT:"value",TEXTAREA:"value",PROGRESS:"value",SELECT:"value",IMG:"src",SOURCE:"src",AUDIO:"src",VIDEO:"src",TRACK:"src",SCRIPT:"src",OPTION:"value",LINK:"href",DETAILS:"open",[MISS]:"textContent"}),propertyFromInputType=valueElseMissDecorator({checkbox:"checked",radio:"checked",[MISS]:"value"}),inputEventFromType=valueElseMissDecorator({checkbox:"change",radio:"change",range:"change",file:"change",[MISS]:"input"}),eventFromTag=valueElseMissDecorator({SELECT:"change",TEXTAREA:"input",BUTTON:"click",[MISS]:"click"}),defaultDirectives={"function":"data-function",variable:"data-variable",element:"data-element",list:"data-list",inside:"data-inside",template:"data-template"},propertyFromElement=e=>{let t;return"INPUT"===(t=e.tagName!==undefined?e.tagName:e)?propertyFromInputType(e.type):propertyFromTag(t)},eventNameFromElement=e=>{const t=e.tagName;return"INPUT"===t?inputEventFromType(e.type):eventFromTag(t)},elementsDeepForEach=(e,t)=>{t(e);let r=e.firstChild;for(;r;)1===r.nodeType?(elementsDeepForEach(r,t),r=r.nextElementSibling):r=r.nextSibling},customElementNameFromElement=e=>{const t=e.getAttribute("is");return t||e.tagName.toLowerCase()},addEventListener=(e,t,r,n=!1)=>{e.addEventListener(t,r,n)},cloneTemplate=e=>(e.content,document.importNode(e.content,!0)),contextFromElement=e=>e.DOM99_C,contextFromEvent=e=>firstAncestorValue(e.target,contextFromElement)||"",contextFromArray=e=>e.join(">"),getParentContext=e=>{const t=e.split(">");return t.pop(),t.join(">")},contextFromArrayWith=(e,t)=>0===e.length?t:`${contextFromArray(e)}>${t}`,normalizeStartPath=e=>e?`${e}>`:e,deleteAllStartsWith=(e,t)=>{Object.keys(e).forEach(r=>{r.startsWith(t)&&delete e[r]})},create=()=>{const e={},t={},r={},n={},o={},a={};let l=[];const s=[];let i=!1;const c=[],p=[];let m;const d={doneSymbol:"*",tokenSeparator:"-",listSeparator:" ",directives:defaultDirectives,propertyFromElement:propertyFromElement,eventNameFromElement:eventNameFromElement,tagNamesForUserInput:["INPUT","TEXTAREA","SELECT","DETAILS"]},u=e=>e.join(">"),E=e=>{l.push(e)},h=function(){l.pop()},f=o=>{deleteAllStartsWith(e,o),deleteAllStartsWith(t,o),deleteAllStartsWith(r,o),deleteAllStartsWith(n,o)},y=(e,t)=>{e[d.propertyFromElement(e)]=t},O=(e,t,r)=>{const n=document.createDocumentFragment();if(hasOwnProperty.call(e,"DOM99_X")&&hasOwnProperty.call(o,e.DOM99_X)){const a=o[e.DOM99_X],s=copyArrayShallow(l);l=t.split(">");const i=normalizeStartPath(t),c=r.length;let p,m;if(hasOwnProperty.call(e,"DOM99_R")){if((p=e.DOM99_R.length)>c){let t;for(t=c;t<p;t+=1)m=`${i}${t}`,e.DOM99_R[t].forEach(removeNode),f(m);e.DOM99_R.length=c}}else e.DOM99_R=[],p=0;r.forEach((t,r)=>{if(v(m=`${i}${r}`,t),r>=p){const t=D(a,String(r));e.DOM99_R.push(freezeLiveCollection(t.childNodes)),n.appendChild(t)}}),l=s}else e.innerHTML="",r.forEach(t=>{const r=document.createElement(e.DOM99_I);isObjectOrArray(t)?Object.assign(r,t):r[e.DOM99_L]=t,n.appendChild(r)});e.appendChild(n)},v=(n,o)=>{if(o===undefined&&(o=n,n=""),isObjectOrArray(n),i||x(n,o),isObjectOrArray(o))if(Array.isArray(o))r[n]=o,hasOwnProperty.call(t,n)&&((e,t,r)=>{e.forEach(e=>{O(e,t,r)})})(t[n],n,o);else{const e=normalizeStartPath(n);i=!0,Object.entries(o).forEach(([t,r])=>{v(`${e}${t}`,r)}),i=!1}else r[n]=o,hasOwnProperty.call(e,n)&&((e,t)=>{t!==undefined&&e.forEach(e=>{y(e,t)})})(e[n],o)},A=(e,t,r)=>{addEventListener(e,t,a[r]),e.DOM99_C=u(l)};let S=A;const g=(e,t)=>{t.split(d.listSeparator).forEach(t=>{const r=t.split(d.tokenSeparator);let n,o;1===r.length?(n=r[0],o=d.eventNameFromElement(e)):[o,n]=r,S(e,o,n)})},T=(e,n)=>{const[o,a,s]=n.split(d.tokenSeparator);let i="-";s?(i=`${a}-${s}`,e.DOM99_X=i):(e.DOM99_L=d.propertyFromElement(a.toUpperCase()),e.DOM99_I=a);const c=contextFromArrayWith(l,o);pushOrCreateArrayAt(t,c,e),hasOwnProperty.call(r,c)&&O(e,c,r[c])},M=(t,n)=>{const o=contextFromArrayWith(l,n);pushOrCreateArrayAt(e,o,t);const a=r[o];if(a!==undefined&&y(t,a),!d.tagNamesForUserInput.includes(t.tagName))return;addEventListener(t,d.eventNameFromElement(t),n=>{const a=t[d.propertyFromElement(t)];r[o]=a,x(o,a),e[o].forEach(e=>{e!==t&&y(e,a)})})},b=(e,t)=>{const r=t,o=contextFromArrayWith(l,r);n[o]=e},N=(e,t)=>{o[t]=e},D=(e,t)=>{E(t);const r=cloneTemplate(e);return C(r),_(),h(),r},F=(e,t)=>{const r=o[customElementNameFromElement(e)];if(r){const n=D(r,t);e.appendChild(n)}else e.setAttribute(d.directives.inside,d.doneSymbol+t),E(t),C(e),h()},I=e=>{if(!e.hasAttribute)return;const t=Object.values(d.directives);if(Array.prototype.slice.call(e.attributes).forEach(e=>{e.nodeName.startsWith("data")&&t.includes(e.nodeName)}),m.forEach(([t,r])=>{if(!e.hasAttribute(t))return;const n=e.getAttribute(t);n[0]!==d.doneSymbol&&(r(e,n),e.setAttribute(t,`${d.doneSymbol}${n}`))}),e.hasAttribute(d.directives.inside)||e.hasAttribute(d.directives.list))return;let r=customElementNameFromElement(e);hasOwnProperty.call(o,r)&&e.appendChild(cloneTemplate(o[r]))},C=(e=document.body)=>(m||(m=[[d.directives.element,b],[d.directives.variable,M],[d.directives["function"],g],[d.directives.list,T],[d.directives.inside,F],[d.directives.template,N]]),elementsDeepForEach(e,I),e),_=function(){const e=u(l);p.forEach(t=>{t(e)})},x=(e,t)=>{c.forEach(r=>{r(e,t)})};return{start:(e={},t={},r=document.body,n=undefined)=>{if(Object.assign(a,e),v(t),C(r),n)return n()},activate:C,elements:n,functions:a,variables:r,get:(e,t)=>{let n;return n=Array.isArray(e)?u(e):e,t&&(n=`${n}>${withWhat}`),r[n]},feed:v,forgetContext:f,deleteTemplate:e=>{hasOwnProperty.call(o,e),o[e].remove(),delete o[e]},plugin:e=>{isObjectOrArray(e),"function"===e.type?(s.push(e.plugin),S=((e,t,r)=>{let n=!1;const o=function(){n=!0};s.forEach(n=>{n(e,t,r,a,o)}),n||A(e,t,r)})):"variable"===e.type?c.push(e.plugin):"cloned"===e.type&&p.push(e.plugin)},options:d}},{start:start,activate:activate,elements:elements,functions:functions,variables:variables,get:get,feed:feed,forgetContext:forgetContext,deleteTemplate:deleteTemplate,plugin:plugin,options:options}=create();export{start,activate,elements,functions,variables,get,feed,forgetContext,deleteTemplate,plugin,options,contextFromArray,contextFromEvent,getParentContext,createElement2,idGenerator};